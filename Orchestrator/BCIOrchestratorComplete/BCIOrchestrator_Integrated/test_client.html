<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCI Orchestrator Test Client</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .status.connected {
            background: #10b981;
            color: white;
        }

        .status.disconnected {
            background: #ef4444;
            color: white;
        }

        .status.connecting {
            background: #f59e0b;
            color: white;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-connect {
            background: #667eea;
            color: white;
        }

        .btn-disconnect {
            background: #ef4444;
            color: white;
        }

        .btn-clear {
            background: #6b7280;
            color: white;
        }

        .current-action {
            background: #f3f4f6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .current-action h3 {
            color: #374151;
            margin-bottom: 10px;
        }

        .action-display {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .confidence-display {
            font-size: 24px;
            color: #6b7280;
            text-align: center;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #374151;
        }

        .event-log {
            background: #1f2937;
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .event-log h3 {
            color: white;
            margin-bottom: 15px;
        }

        .log-entry {
            background: #374151;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #d1d5db;
        }

        .log-action {
            color: #60a5fa;
            font-weight: bold;
        }

        .log-confidence {
            color: #34d399;
        }

        .log-timestamp {
            color: #9ca3af;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§  BCI Orchestrator Test Client</h1>
        <div class="subtitle">Real-time brain command monitor</div>

        <div id="status" class="status disconnected">DISCONNECTED</div>

        <div class="controls">
            <button class="btn-connect" onclick="connect()">Connect</button>
            <button class="btn-disconnect" onclick="disconnect()">Disconnect</button>
            <button class="btn-clear" onclick="clearLogs()">Clear Logs</button>
        </div>

        <div class="current-action">
            <h3>Current Action</h3>
            <div class="action-display" id="currentAction">neutral</div>
            <div class="confidence-display">Confidence: <span id="currentConfidence">0.00</span></div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">Total Events</div>
                <div class="stat-value" id="totalEvents">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Avg Confidence</div>
                <div class="stat-value" id="avgConfidence">0.00</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Uptime</div>
                <div class="stat-value" id="uptime">0s</div>
            </div>
        </div>

        <div class="event-log">
            <h3>Event Log</h3>
            <div id="logContainer"></div>
        </div>
    </div>

    <script>
        let ws = null;
        let totalEvents = 0;
        let totalConfidence = 0;
        let startTime = null;

        function connect() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                return;
            }

            updateStatus('connecting');
            addLog('Connecting to ws://127.0.0.1:8080/stream...', 'info');

            ws = new WebSocket('ws://127.0.0.1:8080/stream');

            ws.onopen = () => {
                updateStatus('connected');
                addLog('Connected successfully!', 'success');
                startTime = Date.now();
                startUptimeCounter();
            };

            ws.onmessage = (event) => {
                try {
                    const brainEvent = JSON.parse(event.data);
                    handleBrainEvent(brainEvent);
                } catch (error) {
                    addLog(`Parse error: ${error.message}`, 'error');
                }
            };

            ws.onerror = (error) => {
                addLog('WebSocket error occurred', 'error');
                updateStatus('disconnected');
            };

            ws.onclose = () => {
                addLog('Connection closed', 'info');
                updateStatus('disconnected');
            };
        }

        function disconnect() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        function handleBrainEvent(event) {
            totalEvents++;
            totalConfidence += event.Confidence;

            // Update current action
            document.getElementById('currentAction').textContent = event.Action;
            document.getElementById('currentConfidence').textContent = event.Confidence.toFixed(2);

            // Update stats
            document.getElementById('totalEvents').textContent = totalEvents;
            document.getElementById('avgConfidence').textContent = (totalConfidence / totalEvents).toFixed(2);

            // Add to log
            const timestamp = new Date(event.Ts).toLocaleTimeString();
            addLog(`[${timestamp}] Action: ${event.Action} | Confidence: ${event.Confidence.toFixed(2)} | Duration: ${event.DurationMs}ms`, 'event');
        }

        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            if (type === 'event') {
                // Highlight action and confidence
                entry.innerHTML = message
                    .replace(/(Action: \w+)/, '<span class="log-action">$1</span>')
                    .replace(/(Confidence: [\d.]+)/, '<span class="log-confidence">$1</span>')
                    .replace(/(\[.*?\])/, '<span class="log-timestamp">$1</span>');
            } else {
                entry.textContent = message;
            }

            logContainer.insertBefore(entry, logContainer.firstChild);

            // Keep only last 50 entries
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.lastChild);
            }
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            totalEvents = 0;
            totalConfidence = 0;
            document.getElementById('totalEvents').textContent = '0';
            document.getElementById('avgConfidence').textContent = '0.00';
            addLog('Logs cleared', 'info');
        }

        function updateStatus(status) {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status ' + status;
            statusEl.textContent = status.toUpperCase();
        }

        function startUptimeCounter() {
            setInterval(() => {
                if (startTime) {
                    const uptime = Math.floor((Date.now() - startTime) / 1000);
                    const minutes = Math.floor(uptime / 60);
                    const seconds = uptime % 60;
                    document.getElementById('uptime').textContent = 
                        minutes > 0 ? `${minutes}m ${seconds}s` : `${seconds}s`;
                }
            }, 1000);
        }

        // Auto-connect on load
        window.addEventListener('load', () => {
            setTimeout(connect, 500);
        });
    </script>
</body>
</html>
